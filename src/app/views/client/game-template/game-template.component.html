<div class="min-h-screen flex flex-col items-center bg-gray-900 text-white p-6">
  <h2 class="text-xl font-bold mb-4 text-purple-400">
    Current Turn: {{ currentTurn }} ({{ currentPlayerName }})
  </h2>

  <!-- Matrix Table -->
  <div class="overflow-x-auto" *ngIf="game">
    <table class="border-collapse border border-gray-700 shadow-lg bg-gray-900 text-white">
      <thead>
        <tr>
          <th class="border border-gray-700 px-4 py-2"></th>
          <th *ngFor="let col of game.columnAttributes" class="border border-gray-700 px-4 py-2 bg-purple-800">
            {{ col.title }}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of game.rowAttributes">
          <th class="border border-gray-700 px-4 py-2 bg-purple-800 text-left">{{ row.title }}</th>
          <td *ngFor="let col of game.columnAttributes"
              class="border border-gray-700 w-36 h-20 text-center transition"
              [ngClass]="{
                'cursor-pointer hover:bg-purple-700': !getMoveForCell(row, col),
                'bg-gray-800 text-gray-400': getMoveForCell(row, col)
              }"
              (click)="!getMoveForCell(row, col) && openModal(row, col)">
            
            <ng-container *ngIf="getMoveForCell(row, col); else emptyCell">
              <div class="flex flex-col items-center justify-center">
                <span class="text-purple-400 font-bold text-lg">
                  {{ getMoveForCell(row, col)?.symbol }}
                </span>
                <span class="text-gray-300 text-sm">
                  {{ getMoveForCell(row, col)?.person?.name }}
                </span>
              </div>
            </ng-container>

            <ng-template #emptyCell>
              <span class="text-gray-300">+</span>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Player Select Modal -->
<div *ngIf="showModal" class="fixed inset-0 flex items-center justify-center bg-black/30 z-50">
  <div class="bg-gray-900 rounded-xl shadow-xl p-6 w-96 text-white">
    <h3 class="text-xl font-semibold mb-4">
      Select Player for:
      <span class="text-purple-400">{{ selectedCell?.row.title }}</span> Ã—
      <span class="text-purple-400">{{ selectedCell?.col.title }}</span>
    </h3>

    <ng-select
      [items]="players"
      bindLabel="name"
      bindValue="id"
      placeholder="Type to search player..."
      [(ngModel)]="selectedPlayer"
      [typeahead]="playerSearch$"
      [loading]="false"
      [minTermLength]="2"
      class="w-full"
    >
    </ng-select>

    <div class="flex justify-end mt-4">
      <button class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600 mr-2" (click)="closeModal()">Cancel</button>
      <button class="px-4 py-2 bg-purple-600 rounded hover:bg-purple-500" (click)="confirmSelection(selectedPlayer)">Confirm</button>
    </div>
  </div>
</div>